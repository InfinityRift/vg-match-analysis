<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>VGU: Analysis</title>

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="css/font-awesome.min.css">
	<link rel="stylesheet" href="css/animate.css">
	<link href="css/prettyPhoto.css" rel="stylesheet">
	<link href="css/style.css" rel="stylesheet" />
    <!-- =======================================================
        Theme Name: Company
        Theme URL: https://bootstrapmade.com/company-free-html-bootstrap-template/
        Author: BootstrapMade
        Author URL: https://bootstrapmade.com
    ======================================================= -->
    <link rel="stylesheet" href="//cdn.jsdelivr.net/chartist.js/latest/chartist.min.css">
    <script src="//cdn.jsdelivr.net/chartist.js/latest/chartist.min.js"></script>
    <!-- override some default chartist colors -->
    <style>
        .ct-label { font-size : 1.5rem; }
        .ct-series-a .ct-slice-pie { fill: #1BBD36; }
        .ct-series-b .ct-slice-pie { fill: #007D16; }
        .ct-series-c .ct-slice-pie { fill: #888; }
        .ct-series-d .ct-slice-pie { fill: #bbb; }
        .panel-footer > ul { color: #000; }
    </style>
  </head>
  <body>
	<header>
		<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
			<div class="navigation">
				<div class="container">
					<div class="navbar-header">
						<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse.collapse">
							<span class="sr-only">Toggle navigation</span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
						</button>
						<div class="navbar-brand">
							<a href="index.html"><h1><span>VG</span>U</h1></a>
						</div>
					</div>

					<div class="navbar-collapse collapse">
						<div class="menu">
							<ul class="nav nav-tabs" role="tablist">
								<li role="presentation"><a href="index.html" class="active">Home</a></li>
								<li role="presentation"><a href="faculty.html">Meet the Faculty</a></li>
								<li role="presentation"><a href="analysis.html">Get Started</a></li>
								<li role="presentation"><a href="about.html">About</a></li>
							</ul>
						</div>
					</div>
				</div>
			</div>
		</nav>
	</header>

	<div id="breadcrumb">
		<div class="container">
			<div class="breadcrumb">
				<li><a href="index.html">Home</a></li>
				<li>Analysis</li>
			</div>
		</div>
	</div>

    <!--
	<div class="map">
		<div id="google-map" data-latitude="40.713732" data-longitude="-74.0092704"></div>
	</div>
    -->

	<section id="login-form" style="display: none;">
        <div class="container" style="margin-top: 1em;"
             id="login-form-inside">
            <div class="center">
                <h2>Log in</h2>
                <p>Provide your IGN and Region to get started.</p>
            </div>
            <div class="row contact-wrap">
                <div class="col-md-6 col-md-offset-3">
                    <form action="" method="get" role="form" class="form-inline text-center">
                        <input type="text" name="ign" class="form-control"
                               id="ign" placeholder="Your IGN"/>
                        <select class="form-control"
                                id="shard" name="shard">
                            <option>NA</option>
                            <option>EU</option>
                            <option>SEA</option>
                            <option>EA</option>
                            <option>SA</option>
                        </select>
                        <br>
                        <button type="submit" name="submit" class="btn btn-primary btn-lg" required="required">Go</button>
                        <p>&nbsp;</p>
                    </form>
                </div>
            </div><!--/.row-->
        </div><!--/.container-->
    </section><!--/#contact-page-->

	<section id="choose-a-match" style="display: none;">
        <div class="container center"
             style="margin-top: 1em; margin-bottom: 1em;">
            <div class="center row" id="choose-a-match-inside">
                <h2 class="text-center">Loading matches...</h2>
            </div>
        </div><!--/.container-->
    </section><!--/#contact-page-->

	<section id="report-results" style="display: none;">
        <div class="container center" id="report-results-inside"
             style="margin-top: 1em; margin-bottom: 1em;">
            <div class="center" row>
                <h2 class="text-center">Loading match analysis...</h2>
            </div>
        </div><!--/.container-->
    </section><!--/#contact-page-->

	<footer>
		<div class="footer">
			<div class="container">
				<div class="social-icon">
					<div class="col-md-4">
						<ul class="social-network">
                            <li><a href="https://github.com/nathancarter/vg-match-analysis"><svg viewBox="0 0 16 16" width="20px" height="20px"><path fill="#cccccc" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg></li>
                            <!--
							<li><a href="#" class="fb tool-tip" title="Facebook"><i class="fa fa-facebook"></i></a></li>
                            -->
							<li><a href="https://twitter.com/NorthThornVG" class="twitter tool-tip" title="Twitter"><i class="fa fa-twitter"></i></a></li>
                            <!--
							<li><a href="#" class="gplus tool-tip" title="Google Plus"><i class="fa fa-google-plus"></i></a></li>
							<li><a href="#" class="linkedin tool-tip" title="Linkedin"><i class="fa fa-linkedin"></i></a></li>
                            -->
							<li><a href="https://www.youtube.com/channel/UCbgosf7UWyBmnqP3-luQymw" class="ytube tool-tip" title="You Tube"><i class="fa fa-youtube-play"></i></a></li>
						</ul>
					</div>
				</div>

				<div class="col-md-4 col-md-offset-4">
					<div class="copyright">
						&copy; Company Theme. All Rights Reserved.
                        <div class="credits">
                            <!--
                                All the links in the footer should remain intact.
                                You can delete the links only if you purchased the pro version.
                                Licensing information: https://bootstrapmade.com/license/
                                Purchase the pro version with working PHP/AJAX contact form: https://bootstrapmade.com/buy/?theme=Company
                            -->
                            <a href="https://bootstrapmade.com/free-business-bootstrap-themes-website-templates/">Business Bootstrap Themes</a> by <a href="https://bootstrapmade.com/">BootstrapMade</a>
                        </div>
					</div>
				</div>
			</div>
			<div class="pull-right">
				<a href="#home" class="scrollup"><i class="fa fa-angle-up fa-3x"></i></a>
			</div>
		</div>
	</footer>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
	<script src="js/jquery-2.1.1.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
	<script src="js/jquery.prettyPhoto.js"></script>
    <script src="js/jquery.isotope.min.js"></script>
	<script src="js/wow.min.js"></script>
	<script src="js/functions.js"></script>
    <script>
        // get the 3 sections in this page
        var sections = [
            document.getElementById( 'login-form' ),
            document.getElementById( 'choose-a-match' ),
            document.getElementById( 'report-results' )
        ];
        var insides = [
            document.getElementById( 'login-form-inside' ),
            document.getElementById( 'choose-a-match-inside' ),
            document.getElementById( 'report-results-inside' )
        ];
        // do we have a query string?
        var queryStart = window.location.href.indexOf( '?' );
        if ( queryStart > -1 ) {
            var parts = window.location.href.substr( queryStart + 1 )
                              .split( '&' );
            window.queryDict = { };
            for ( var i = 0 ; i < parts.length ; i++ ) {
                var halves = parts[i].split( '=' );
                window.queryDict[halves[0]] = halves[1];
            }
            // if the player has logged in:
            if ( window.queryDict.ign ) {
                // if he or she has not chosen a match:
                if ( !window.queryDict.match ) {
                    sections[1].style.display = 'block';
                    $.ajax( {
                        url: '/query?ign=' + window.queryDict.ign
                           + '&shard=' + window.queryDict.shard
                    } ).done( function( data ) {
                        insides[1].innerHTML = renderMatchList( data );
                        $( document ).ready( function () {
                            $( '[data-toggle="tooltip"]' ).tooltip();
                        } );
                    } ).fail( function ( xhr, status, error ) {
                        insides[1].innerHTML =
                            renderMatchListError( error );
                    } );
                } else { // or if he or she has chosen a match:
                    sections[2].style.display = 'block';
                    $.ajax( {
                        url: '/query?ign=' + window.queryDict.ign
                           + '&shard=' + window.queryDict.shard
                           + '&match=' + window.queryDict.match
                    } ).done( function( data ) {
                        insides[2].innerHTML =
                            renderMatchAnalysis( data );
                    } ).fail( function ( xhr, status, error ) {
                        insides[2].innerHTML =
                            renderMatchAnalysisError( error );
                    } );
                }
            } else {
                sections[0].style.display = 'block';
            }
        } else {
            sections[0].style.display = 'block';
        }
        // rendering functions
        function renderHero ( name ) {
            return '<img width="50%" src="images/heroes/'
                 + name.toLowerCase() + '.png">';
        }
        function renderIGN ( ign ) {
            return ( ign == window.queryDict.ign ) ?
                '<strong>' + ign + '</strong>' : ign;
        }
        function renderStats ( participant ) {
            return participant.kills
                 + '/' + participant.deaths
                 + '/' + participant.assists;
        }
        function renderTeam ( team ) {
            var result = '<table border=0><tr>';
            for ( var i = 0 ; i < team.length ; i++ )
                result += '<td align=center>' + renderHero( team[i].hero )
                        + '</td>';
            result += '</tr><tr>'
            for ( var i = 0 ; i < team.length ; i++ )
                result += '<td align=center><p>'
                       + renderIGN( team[i].ign ) + '<br>'
                       + renderStats( team[i] ) + '</p></td>';
            result += '</tr></table>'
            return result;
        }
        function renderMatch ( match, withButton ) {
            var result = '<hr>';
            result += '<table align=center border=0>';
            result += '<tr><td colspan=3 align=center><h4>'
                    + new Date( match.time ) + '</h4></td></tr>';
            result += '<tr><td align=center>';
            result += renderTeam( match.left );
            result += '</td><td align=center><h2>vs.</h2></td>'
                    + '<td align=center>';
            result += renderTeam( match.right );
            result += '</td>';
            if ( withButton ) {
                if ( match.telemetry ) {
                    result += '<td>'
                            + '<a role="button" name="analyze-'
                            + match.id + '" class="btn btn-primary btn-lg"'
                            + ' href="analysis.html?ign='
                            + window.queryDict.ign + '&shard='
                            + window.queryDict.shard + '&match='
                            + match.id + '">Go</a>'
                            + '</td>';
                } else {
                    result += '<td>'
                            + '<a role="button" name="analyze-' + match.id
                            + '" class="btn btn-danger btn-lg"'
                            + ' data-toggle="tooltip"'
                            + ' title="The Vainglory servers do not '
                            + 'provide play-by-play data for every single '
                            + 'match yet.  The service is still new."'
                            + '>Unavailable</a>'
                            + '</td>';
                }
            }
            result += '</tr></table>';
            return result;
        }
        function renderMatchList ( data ) {
            if ( ( data.length == 0 ) || data.error )
                return renderMatchListError();
            var result = '<h2>Which match should the professors'
                       + ' analyze?</h2>';
            for ( var i = 0 ; i < data.length ; i++ )
                result += renderMatch( data[i], true );
            return result;
        }
        function renderMatchListError ( error ) {
            return '<h2>Could not find your matches</h2>'
                 + '<p>Did you type your IGN correctly?</p>'
                 + '<p>Did you select the correct region?</p>'
                 + '<p>If so, then perhaps there is something '
                 + 'wrong on our end.</p>'
                 + '<p>Feel free to report it using the GitHub link'
                 + ' at the bottom of the page.</p>'
                 + '<h2><a href="analysis.html">'
                 + '<i class="fa fa-backward"></i>'
                 + ' Back to login page '
                 + '<i class="fa fa-backward"></i></a></h2>'
                 + ( error ?
                     '<pre>' + JSON.stringify( error, null, 4 ) + '</pre>'
                     : '' );
        }
        var nextChartNumber = 0;
        function renderData ( data ) {
            if ( data instanceof Array ) {
                var result = '';
                for ( var i = 0 ; i < data.length ; i++ )
                    result += renderData( data[i] );
                return result;
            }
            if ( data.type == 'positionInData' ) {
                function niceNum ( x ) {
                    return ( x == 0 ) ? '0' :
                        ( -0.1 < x ) && ( x < 0.1 ) ?
                            Number( x ).toFixed( 3 ) :
                        ( -1 < x ) && ( x < 1 ) ?
                            Number( x ).toFixed( 2 ) :
                        ( -10 < x ) && ( x < 10 ) ?
                            Number( x ).toFixed( 1 ) :
                            Number( x ).toFixed( 0 );
                }
                var max = Math.max( data.quartiles[4], data.value );
                var pct = max ? 100 * data.value / max : 0;
                pct = Number( pct ).toFixed( 0 );
                return '<p><strong>' + data.name
                     + ': ' + data.value + '</strong></p>'
                     + '<div class="progress">'
                     + '  <div class="progress-bar color1"'
                     + '       role="progressbar"'
                     + '       aria-valuemin="0" aria-valuemax="'+max+'"'
                     + '       style="width: '+pct+'%">'
                     + '         <span class="bar-width">'+pct+'%</span>'
                     + '  </div>'
                     + '</div>'
                     + '<p>(others ranged from '
                     + niceNum( data.quartiles[0] ) + ' to '
                     + niceNum( data.quartiles[4] ) + ')</p>'
                     + '<p>&nbsp;</p>';
            }
            if ( data.type == 'table' ) {
                var result = '<table align=center border=0'
                           + ' style="border-spacing: 0.5em; '
                           + '        border-collapse: separate;">'
                var lastRowSize = 0;
                for ( var i = 0 ; i < data.rows.length ; i++ ) {
                    if ( ( i > 0 ) && !data.compact )
                        result += '\n<tr><td colspan=' + lastRowSize
                                + '</td><hr></td></tr>';
                    result += '\n<tr>';
                    var row = data.rows[i];
                    var numRows = ( row.headings ? 1 : 0 )
                                + ( row.data ? 1 : 0 );
                    if ( row.icon ) {
                        result += '\n<td rowspan=' + numRows + '>'
                                + '<img src="images/icons/' + row.icon
                                + '.png"></td>';
                        if ( i == 0 ) lastRowSize++;
                    }
                    function addRow ( cells, tag ) {
                        for ( var j = 0 ; j < cells.length ; j++ )
                            result += '<' + tag + '><p>&nbsp;' + cells[j]
                                    + '&nbsp;</p></' + tag + '>';
                    }
                    if ( row.headings ) {
                        addRow( row.headings, 'th' );
                        if ( i == 0 ) lastRowSize += row.headings.length;
                    }
                    if ( numRows == 2 ) result += '\n</tr>\n<tr>';
                    if ( row.data ) {
                        addRow( row.data, 'td' );
                        if ( i == 0 ) lastRowSize += row.data.length;
                    }
                    result += '\n</tr>';
                }
                return result + '\n</table>';
            }
            if ( data.type == 'pie' ) {
                var pieChartData = {
                    labels : [ ],
                    series : [ ],
                    colors : [ ]
                };
                for ( var key in data.portions ) {
                    if ( data.portions.hasOwnProperty( key )
                      && ( data.portions[key] > 0 ) ) {
                        pieChartData.labels.push( key );
                        pieChartData.series.push( data.portions[key] );
                    }
                }
                nextChartNumber++;
                setTimeout( function ( num ) {
                    new Chartist.Pie( '#chartist'+num, pieChartData );
                }, 100, nextChartNumber );
                return '<div id="chartist' + nextChartNumber
                     + '" class="ct-chart ct-perfect-fourth"></div>';
            }
            return '<pre>' + JSON.stringify( data, null, 2 ) + '</pre>';
        }
        function renderOneProfessor ( advice ) {
            var result = '<div class="row"><hr>';
            if ( advice.letter )
                advice.letter = advice.letter.toUpperCase();
            var article = advice.letter == 'A' ? 'an' :
                          advice.letter == 'F' ? 'an' :
                          advice.letter == 'incomplete' ? 'an' : 'a';
            result += '<h3><strong>' + advice.prof + '</strong>';
            if ( advice.letter ) {
                result += ' gives you ' + article + ' '
                        + '<strong>' + advice.letter + '</strong>.</h3>';
            } else {
                result += ' did not give you a grade.</h3>';
            }
            result += '<hr></div>';
            result += '<div class="row">'
                    + '<div class="col-md-4" style="text-align: center;">'
                    + '<img width="290"'
                    + '     src="images/prof-heroes/' + advice.shortName
                    + '.png" alt="">'
                    + '<h3>"' + advice.quote + '"</h3>'
                    + '</div>';
            var adviceBlock =
                '<div class="panel panel-default">'
              + '<div class="panel-heading"><h4>' + advice.topic
              + '</h4></div>'
              + '<div class="panel-body"><p>' + advice.short + '</p></div>'
              + '<div class="panel-footer"><p>' + advice.long + '</p></div>'
              + '</div>';
            if ( advice.data && ( advice.data.length > 0 ) ) {
                if ( ( advice.data.length == 3 )
                  && ( advice.data[0].type == 'table' ) ) {
                    result += '<div class="col-md-8">'
                            + adviceBlock + '</div>'
                            + '</div><div class="row">'
                            + '<div class="col-md-4">'
                            + renderData( advice.data[0] ) + '</div>'
                            + '<div class="col-md-4">'
                            + renderData( advice.data[1] ) + '</div>'
                            + '<div class="col-md-4">'
                            + renderData( advice.data[2] ) + '</div>';
                } else if ( advice.data[0].type == 'table' ) {
                    result += '<div class="col-md-8">' + adviceBlock
                            + renderData( advice.data )
                            + '</div>';
                } else {
                    result += '<div class="col-md-4" '
                            + '     style="padding-right: 2em;">'
                            + adviceBlock + '</div>'
                            + '<div class="col-md-4">'
                            + renderData( advice.data )
                            + '</div>';
                }
            } else {
                result += '<div class="col-md-8">' + adviceBlock + '</div>'
            }
            result += '</div>';
            return result;
        }
        function renderMatchAnalysis ( data ) {
            if ( data.error ) return renderMatchAnalysisError( data );
            var result = '<div class="row">'
                       + '<h2>The faculty have reviewed this match:</h2>'
                       + '</div>';
            result += renderMatch( data.match, false );
            result += '<hr>'
                    + '<div class="row"><h2>The grades are in:</h2></div>';
            for ( var i = 0 ; i < data.advice.length ; i++ )
                result += renderOneProfessor( data.advice[i] );
            return result;
        }
        function renderMatchAnalysisError ( error ) {
            if ( error.error == 'Could not fetch telemetry data' ) {
                return '<h2>Match data not available</h2>'
                     + '<p>The Vainglory servers don\'t seem to have'
                     + ' play-by-play information for that match,'
                     + '<br>so the professors don\'t have anything to '
                     + ' coach you on.</p>'
                     + '<h2><a href="analysis.html?ign='
                     + window.queryDict.ign + '&shard='
                     + window.queryDict.shard + '">'
                     + '<i class="fa fa-backward"></i>'
                     + ' Pick a different match '
                     + '<i class="fa fa-backward"></i></a></h2>';
            } else {
                return '<h2>Internal error</h2>'
                     + '<p>How embarrassing.  I wish this website were '
                     + 'perfect, but it turns out we\'ve hit an error.'
                     + ' Feel free to report it using the GitHub link'
                     + ' at the bottom of the page.</p>'
                     + '<pre>'
                     + JSON.stringify( error.error, null, 4 )
                     + '</pre>';
            }
        }
    </script>
</body>
</html>
